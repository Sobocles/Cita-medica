<!-- HTML del formulario mejorado -->
<div class="container-fluid py-4">
  <div class="card shadow-sm border-0">
    <div class="card-header bg-primary text-white">
      <h5 class="mb-0">{{ isEditMode ? 'Editar Tipo de Cita' : 'Nuevo Tipo de Cita' }}</h5>
    </div>
    <div class="card-body p-4">
      <form [formGroup]="formularioTipoCita" (ngSubmit)="onSubmit()">
        <div class="form-group mb-4">
          <label for="especialidad_medica" class="form-label fw-bold">Especialidad Médica</label>
          <div class="input-group">
            <span class="input-group-text bg-light">
              <i class="fas fa-user-md"></i>
            </span>
            <input type="text" id="especialidad_medica" formControlName="especialidad_medica" 
                   class="form-control form-control-lg" placeholder="Ej: Cardiología">
          </div>
          <div *ngIf="formularioTipoCita.controls['especialidad_medica'].touched && 
                      formularioTipoCita.controls['especialidad_medica'].hasError('required')" 
               class="text-danger mt-1 small">
            <i class="fas fa-exclamation-circle me-1"></i>La especialidad médica es requerida
          </div>
        </div>
      
        <div class="form-group mb-4">
          <label for="precio" class="form-label fw-bold">Precio Base</label>
          <div class="input-group">
            <span class="input-group-text bg-light">$</span>
            <input type="text" id="precio" formControlName="precio"
                   class="form-control form-control-lg" placeholder="Ej: 50000">
          </div>
          <small class="text-muted">Precio de referencia. Los precios diferenciados se aplican según el sistema de salud del paciente.</small>
          <div *ngIf="formularioTipoCita.controls['precio'].touched">
            <div *ngIf="formularioTipoCita.controls['precio'].hasError('required')"
                 class="text-danger mt-1 small">
              <i class="fas fa-exclamation-circle me-1"></i>El precio es requerido
            </div>
            <div *ngIf="formularioTipoCita.controls['precio'].hasError('pattern')"
                 class="text-danger mt-1 small">
              <i class="fas fa-exclamation-circle me-1"></i>Solo se permiten números enteros sin ceros a la izquierda
            </div>
          </div>
        </div>

        <!-- Sección de Precios Diferenciados -->
        <div class="card bg-light mb-4">
          <div class="card-header">
            <h6 class="mb-0"><i class="fas fa-money-bill-wave me-2"></i>Precios Diferenciados por Sistema de Salud</h6>
          </div>
          <div class="card-body">
            <div class="row">
              <!-- Precio Fonasa -->
              <div class="col-md-4 mb-3">
                <label for="precio_fonasa" class="form-label fw-bold text-success">
                  <i class="fas fa-heart-pulse me-1"></i>Precio Fonasa
                </label>
                <div class="input-group">
                  <span class="input-group-text bg-success text-white">$</span>
                  <input type="text" id="precio_fonasa" formControlName="precio_fonasa"
                         class="form-control" placeholder="Opcional">
                </div>
                <small class="text-muted">Sugerido: 70% del precio base</small>
                <div *ngIf="formularioTipoCita.controls['precio_fonasa'].touched &&
                            formularioTipoCita.controls['precio_fonasa'].hasError('pattern')"
                     class="text-danger mt-1 small">
                  <i class="fas fa-exclamation-circle me-1"></i>Solo números enteros
                </div>
              </div>

              <!-- Precio Isapre -->
              <div class="col-md-4 mb-3">
                <label for="precio_isapre" class="form-label fw-bold text-primary">
                  <i class="fas fa-building me-1"></i>Precio Isapre
                </label>
                <div class="input-group">
                  <span class="input-group-text bg-primary text-white">$</span>
                  <input type="text" id="precio_isapre" formControlName="precio_isapre"
                         class="form-control" placeholder="Opcional">
                </div>
                <small class="text-muted">Sugerido: 85% del precio base</small>
                <div *ngIf="formularioTipoCita.controls['precio_isapre'].touched &&
                            formularioTipoCita.controls['precio_isapre'].hasError('pattern')"
                     class="text-danger mt-1 small">
                  <i class="fas fa-exclamation-circle me-1"></i>Solo números enteros
                </div>
              </div>

              <!-- Precio Particular -->
              <div class="col-md-4 mb-3">
                <label for="precio_particular" class="form-label fw-bold text-secondary">
                  <i class="fas fa-user me-1"></i>Precio Particular
                </label>
                <div class="input-group">
                  <span class="input-group-text bg-secondary text-white">$</span>
                  <input type="text" id="precio_particular" formControlName="precio_particular"
                         class="form-control" placeholder="Opcional">
                </div>
                <small class="text-muted">Sugerido: 100% del precio base</small>
                <div *ngIf="formularioTipoCita.controls['precio_particular'].touched &&
                            formularioTipoCita.controls['precio_particular'].hasError('pattern')"
                     class="text-danger mt-1 small">
                  <i class="fas fa-exclamation-circle me-1"></i>Solo números enteros
                </div>
              </div>
            </div>
            <div class="alert alert-info mb-0">
              <i class="fas fa-info-circle me-2"></i>
              <strong>Nota:</strong> Si no especifica precios diferenciados, se aplicarán automáticamente los porcentajes sugeridos sobre el precio base al momento del pago.
            </div>
          </div>
        </div>

        <div class="form-group mb-4">
          <label for="duracion_cita" class="form-label fw-bold">Duración de la Cita</label>
          <div class="input-group">
            <span class="input-group-text bg-light">
              <i class="fas fa-clock"></i>
            </span>
            <input type="text" id="duracion_cita" formControlName="duracion_cita" 
                   class="form-control form-control-lg" placeholder="Máximo 180 minutos">
            <span class="input-group-text bg-light">min</span>
          </div>
          <small class="text-muted">Solo minutos, duración máxima 180 minutos (3 horas)</small>
          
          <div *ngIf="formularioTipoCita.controls['duracion_cita'].touched">
            <div *ngIf="formularioTipoCita.controls['duracion_cita'].hasError('required')" 
                 class="text-danger mt-1 small">
              <i class="fas fa-exclamation-circle me-1"></i>La duración de la cita es requerida
            </div>
            <div *ngIf="formularioTipoCita.controls['duracion_cita'].hasError('pattern')" 
                 class="text-danger mt-1 small">
              <i class="fas fa-exclamation-circle me-1"></i>Solo se permiten números enteros para representar minutos
            </div>
            <div *ngIf="formularioTipoCita.controls['duracion_cita'].hasError('max')" 
                 class="text-danger mt-1 small">
              <i class="fas fa-exclamation-circle me-1"></i>La duración de la cita no puede exceder los 180 minutos (3 hrs)
            </div>
          </div>
          
          <div *ngIf="formularioTipoCita.controls['duracion_cita']?.valid && formularioTipoCita.get('duracion_cita')?.value" 
               class="mt-2 text-primary fw-bold">
            <i class="fas fa-info-circle me-1"></i>{{ convertirMinutosAHoras(formularioTipoCita.get('duracion_cita')?.value) }}
          </div>
        </div>
      
        <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
          <button type="button" class="btn btn-outline-secondary me-md-2" routerLink="/gestionar-tipo-cita">
            <i class="fas fa-times me-1"></i>Cancelar
          </button>
          <button type="submit" class="btn btn-primary" [disabled]="!formularioTipoCita.valid">
            <i class="fas fa-save me-1"></i>{{ isEditMode ? 'Guardar Cambios' : 'Crear Tipo Cita' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>