<!-- payment-success.component.html -->
<button (click)="volverAInicio()" class="btn btn-secondary mt-3">Volver a Inicio</button>
<div  *ngIf="detallesCita">
    <h2>Detalles de la Cita</h2>
    <p><strong>Motivo:</strong> {{ detallesCita.motivo }}</p>
    <p><strong>Fecha:</strong> {{ detallesCita.fecha }}</p>
    <p><strong>Hora de Inicio:</strong> {{ detallesCita.hora_inicio }}</p>
    <p><strong>Hora de Fin:</strong> {{ detallesCita.hora_fin }}</p>
    <p><strong>Estado:</strong> {{ detallesCita.estado }}</p>

  
    <h3>Informaci√≥n del M√©dico</h3>
    <p><strong>Nombre:</strong> {{ detallesCita.medico.nombre }} {{ detallesCita.medico.apellidos }}</p>
    <p><strong>Especialidad:</strong> {{ detallesCita.medico.especialidad_medica }}</p>
  
    <h3>Informaci√≥n del Paciente</h3>
    <p><strong>Nombre:</strong> {{ detallesCita.paciente.nombre }} {{ detallesCita.paciente.apellidos }}</p>
    <p><strong>Email:</strong> {{ detallesCita.paciente.email }}</p>
  
    <div *ngIf="detallesCita.factura">
      <h3>Detalles de Facturaci√≥n</h3>
      <p><strong>M√©todo de Pago:</strong> {{ detallesCita.factura.payment_method_id }}</p>

      <!-- Mostrar precios con descuento si aplica -->
      <div *ngIf="detallesCita.descuento_aplicado && detallesCita.descuento_aplicado > 0" class="alert alert-success">
        <h4>üí∞ Descuento Aplicado</h4>
        <p><strong>Precio Normal:</strong> <span style="text-decoration: line-through;">${{ detallesCita.precio_original | number:'1.0-0' }}</span></p>
        <p><strong>Descuento {{ detallesCita.tipo_prevision_aplicada }} ({{ detallesCita.porcentaje_descuento }}%):</strong> -${{ detallesCita.descuento_aplicado | number:'1.0-0' }}</p>
        <p><strong>Total Pagado:</strong> <span class="text-success" style="font-size: 1.3em;">${{ detallesCita.precio_final | number:'1.0-0' }}</span></p>
      </div>

      <!-- Mostrar precio normal si no hay descuento -->
      <p *ngIf="!detallesCita.descuento_aplicado || detallesCita.descuento_aplicado === 0"><strong>Monto Pagado:</strong> ${{ detallesCita.factura.monto_pagado | number:'1.0-0' }}</p>

      <p><strong>Estado del Pago:</strong> {{ detallesCita.factura.estado_pago }}</p>
    </div>

    <!-- ADVERTENCIA DE DOCUMENTOS SI REQUIERE VALIDACI√ìN -->
    <div *ngIf="detallesCita.requiere_validacion_prevision && !detallesCita.prevision_validada" class="alert alert-warning" style="border-left: 4px solid #ffc107; margin-top: 20px;">
      <h3 style="color: #856404; margin-top: 0;">‚ö†Ô∏è MUY IMPORTANTE - LEA CON ATENCI√ìN</h3>
      <p style="font-weight: bold; font-size: 1.1em;">Ha seleccionado pago con {{ detallesCita.tipo_prevision_aplicada?.toUpperCase() }}.</p>

      <p><strong>DEBE TRAER A LA CITA:</strong></p>
      <ul>
        <li *ngIf="detallesCita.tipo_prevision_aplicada === 'Fonasa'">‚úì Carnet Fonasa vigente</li>
        <li *ngIf="detallesCita.tipo_prevision_aplicada === 'Isapre'">‚úì Credencial de Isapre vigente</li>
        <li>‚úì C√©dula de identidad</li>
      </ul>

      <div class="alert alert-danger" style="margin-top: 10px;">
        <p style="font-weight: bold;">
          Si no presenta estos documentos, deber√° pagar la diferencia de
          <span style="font-size: 1.2em;">${{ detallesCita.descuento_aplicado | number:'1.0-0' }}</span>
          en efectivo en la cl√≠nica.
        </p>
      </div>
    </div>

    <!-- CONFIRMACI√ìN DE VALIDACI√ìN SI YA VALID√ì -->
    <div *ngIf="detallesCita.prevision_validada" class="alert alert-success" style="margin-top: 20px;">
      <h3>‚úÖ Previsi√≥n Validada</h3>
      <p>Su previsi√≥n ha sido validada correctamente.</p>
      <p *ngIf="detallesCita.observaciones_validacion"><strong>Observaciones:</strong> {{ detallesCita.observaciones_validacion }}</p>
    </div>
    <div *ngIf="AuthService.infoClinica" class="info-clinica">
      <h3>Informaci√≥n de Contacto de la Cl√≠nica</h3>
      <p><strong>Nombre de la Cl√≠nica:</strong> {{ AuthService.infoClinica.nombreClinica }}</p>
      <p><strong>Direcci√≥n:</strong> {{ AuthService.infoClinica.direccion }}</p>
      <p><strong>Tel√©fono:</strong> {{ AuthService.infoClinica.telefono }}</p>
      <p><strong>Email:</strong> {{ AuthService.infoClinica.email }}</p>
  </div>
  <button (click)="imprimir()" class="btn btn-primary mt-3 btn-imprimir">Imprimir Detalles</button>
  
  </div>
  
